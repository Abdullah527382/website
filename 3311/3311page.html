<!doctype html>
<html lang="en">
  <head>
    <!-- FAVICON: -->
    <link rel="icon" type="image/png" href="../pictures/favicon.png"/>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.1.1">
    <title>JS</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.5/examples/navbar-fixed/">



    <!-- Bootstrap core CSS -->
    <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  	<link href="../js/prism.css" rel="stylesheet" />

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- Bootstrap CSS -->
    <!-- OLD style sheet: (from template)-->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous"> -->

  
    <!-- ALL bootstrap classes: https://www.w3schools.com/bootstrap/bootstrap_ref_all_classes.asp-->

    <!-- Custom styles for this template -->
    <!-- Custom styles for this template -->
    <link href="navbar-top-fixed.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/custom.css">
  </head>

  <body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <a class="navbar-brand" href="../index.html">Home</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
          <!-- Links to our pages-->
          <li class="nav-item">
            <div class="btn-group">
              <a class="nav-link" href="../eloquentJS/learnjs.html"> JavaScript</a>

              <button type="button" class="btn btn-dropdown dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" href="eloquentJS/learnjs.html">
                <span class="sr-only" >Toggle Dropdown</span>
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href="../eloquentJS/learnjs.html#chapter-1-values-types-and-operators">Chapter 1</a>
                <a class="dropdown-item" href="../eloquentJS/learnjs.html#chapter-2-program-structure">Chapter 2</a>
                <a class="dropdown-item" href="../eloquentJS/learnjs.html#chapter-3-functions">Chapter 3</a>
                <a class="dropdown-item" href="../eloquentJS/learnjs.html#chapter-4-objects-and-arrays">Chapter 4</a>
                <a class="dropdown-item" href="../eloquentJS/learnjs.html#chapter-5-higher-order-functions">Chapter 5</a>
                <a class="dropdown-item" href=../eloquentJS/learnjs.html#chapter-6-the-secret-life-of-objects>Chapter 6</a>
                <a class="dropdown-item" href=../eloquentJS/learnjs.html#chapter-7-project-a-robot>Chapter 7</a>
                <a class="dropdown-item" href=../eloquentJS/learnjs.html#chapter-8-bugs-and-errors>Chapter 8</a>

              </div>
            </div>          </li>
          <li class="nav-item">
            <a class="nav-link" href="../Algos/Algospage.html">Algos</a>
          </li>
          <li>
            <div class="btn-group">
              <a class="nav-link" href="../2511/2511page.html"> COMP2511</a>
  
              <button type="button" class="btn btn-dropdown dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" href="2511/2511page.html">
                <span class="sr-only" >Toggle Dropdown</span>
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href=#>Week 1</a>
                <a class="dropdown-item" href=#>Week 2</a>
                <a class="dropdown-item" href=#>Week 3</a>
                <a class="dropdown-item" href=#>Week 4</a>
                <a class="dropdown-item" href=#>Week 5</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href=../2511/tutorials/2511tutes.html>Tutorials</a>
                <a class="dropdown-item" href=../2511/labs/2511labs.html>Labs</a>
              </div>
            </div> 
          </li>
          <li>
            <div class="btn-group">
              <a class="nav-link active" href="../3311/3311page.html"> COMP3311</a>
  
              <button type="button" class="btn btn-dropdown dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" href="2511/2511page.html">
                <span class="sr-only" >Toggle Dropdown</span>
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href=#>Week 1</a>
                <a class="dropdown-item" href=#>Week 2</a>
                <a class="dropdown-item" href=#>Week 3</a>
                <a class="dropdown-item" href=#>Week 4</a>
                <a class="dropdown-item" href=#>Week 5</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href=./tutorials/3311tutes.html>Tutorials</a>
                <a class="dropdown-item" href=./labs/3311labs.html>Labs</a>
              </div>
            </div> 
          </li>
          <li>
            <div class="btn-group">
              <a class="nav-link" href="../3331/3331page.html"> COMP3331</a>
    
              <button type="button" class="btn btn-dropdown dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" href="3331/3331page.html">
                <span class="sr-only" >Toggle Dropdown</span>
              </button>
              <div class="dropdown-menu">
                <a class="dropdown-item" href=#>Week 1</a>
                <a class="dropdown-item" href=#>Week 2</a>
                <a class="dropdown-item" href=#>Week 3</a>
                <a class="dropdown-item" href=#>Week 4</a>
                <a class="dropdown-item" href=#>Week 5</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href=../3331/tutorials/3331tutes.html>Tutorials</a>
                <a class="dropdown-item" href=../3331/labs/3331labs.html>Labs</a>
              </div>
            </div> 
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../project/project.html">Project</a>
          </li>
    </ul>
 
  </div>
</nav>
  <!-- TYPOGRAPHY -->
  <div class="container">
    <h1  class="border-bottom">COMP3311 Progress<small>  by Abdullah A </small></h1>
    <p class="lead">
      This page will primarily be about the course: <strong>Databases and systems</strong> which I'm undertaking in T3 of 2020. 
      Content will mostly be notes and tutorial exercises. Labs and assignments won't be posted till end of course. 
    <!-- Beginning paragraph: -->
    <hr> 
<!-- COMP3311 OUTLINE: -->
<h2 class="mume-header" id="course-outline">Course Overview</h2>
<hr>
<table class="table">
  <tbody>
    <tr>
      <td>
        <strong> Week </strong>
      </td>
      <td>
        <strong> Lectures </strong>
      </td>
      <td>
        <strong> Tutes </strong>
      </td>
      <td>
        <strong> Prac Work </strong>
      </td>
      <td>
        <strong> Assignments </strong>
      </td>
      <td>
        <strong> Quizzes </strong>
      </td>
    </tr>
    <tr>
      <td>1</td>
      <td>Course intro, Data Modelling, ER diagrams</td>
      <td>Welcome</td>
      <td>Set up PostgreSQL server</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Relational Model, SQL DDL, Mapping ER to SQL</td>
      <td>Data modelling, ER</td>
      <td>Defining a database</td>
      <td>Ass1 release</td>
      <td>Quiz 1 submission deadline: 12:00 am Fri 25 Sep 2020</td>
    </tr>
    <tr>
      <td>3</td>
      <td>SQL (i)</td>
      <td>ER -&gt; SQL</td>
      <td>Simple SQL</td>
      <td>-</td>
      <td>Quiz 2 submission deadline: 12:00 am Fri 02 Oct 2020</td>
    </tr>
    <tr>
      <td>4</td>
      <td>SQL (ii), PLpgSQL(i)</td>
      <td>SQL</td>
      <td>More interesting SQL</td>
      <td><strong>Ass1 due</strong>/Ass2 release</td>
      <td>Quiz 3 submission deadline: 12:00 am Fri 09 Oct 2020</td>
    </tr>
    <tr>
      <td>5</td>
      <td>PLpgSQL (ii), Triggers, Aggregates</td>
      <td>PLpgSQL functions</td>
      <td>PLpgSQL functions</td>
      <td>Ass3 release</td>
      <td>Quiz 4 submission deadline: 12:00 am Fri 16 Oct 2020</td>
    </tr>
    <tr>
      <td>6</td>
      <td>Flexibility Week</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <td>7</td>
      <td>DB/PL interaction, Python, Psycopg2</td>
      <td>Triggers</td>
      <td>Aggregates</td>
      <td><strong>Ass2 due</strong></td>
      <td>Quiz 5 submission deadline: 12:00 am Fri 30 Oct 2020</td>
    </tr>
    <tr>
      <td>8</td>
      <td>Functional dependencies, Normalization</td>
      <td>Psycopg2</td>
      <td>Python meets SQL</td>
      <td>-</td>
      <td>Quiz 6 submission deadline: 12:00 am Fri 06 Nov 2020</td>
    </tr>
    <tr>
      <td>9</td>
      <td>Relational Algebra, Query execution, Tuning</td>
      <td>Normalization</td>
      <td>-</td>
      <td>-</td>
      <td>Quiz 7 submission deadline: 12:00 am Fri 13 Nov 2020</td>
    </tr>
    <tr>
      <td>10</td>
      <td>
        Transactions, Concurrency control, Database futures, Course review
      </td>
      <td>Relational algebra</td>
      <td>Sample exam</td>
      <td>
        <strong>Ass3 due</strong>
        <br />
      </td>
      <td>Quiz 8 submission deadline: 12:00 am Fri 20 Nov 2020</td>
    </tr>
  </tbody>
</table>
<!-- CONTENT -->
  </head>
  <body for="html-export">
    <div class="mume markdown-preview  ">
    <h2 class="mume-header" id="week-1">Week 1</h2>

<h4 class="mume-header" id="this-weeks-topics">This week&apos;s topics:</h4>

<ul>
<li>Data Modeling</li>
<li>ER Data Model</li>
<li>Relational Data Model</li>
<li>ER-to-relational Mapping</li>
</ul>
<h4 class="mume-header" id="upcoming-topics">Upcoming topics:</h4>

<ul>
<li>SQL Data Definition Language</li>
</ul>
<h4 class="mume-header" id="db-overview">DB Overview:</h4>

<p><strong>Database application development:</strong></p>
<ol>
<li>Analyse application requirements</li>
<li>Develop a data model meeting these requirements</li>
<li>Check data model for redundancy</li>
<li>Implement the data model as relational schema</li>
<li>Define operations on this model</li>
<li>Implement operations via SQL and procedural PLs (languages)</li>
<li>Construct a program interface to these operations</li>
<li>Monitor performance and tune the schema/operations</li>
</ol>
<p>(At some point we would wanna populate the database, could be via the interface)<br>
We will only consider 2,4,6,7,3</p>
<p><strong>Client-Server architecture</strong>:<br>
The typical environment for a DBMS consists of a an actual database which is connected to the server (both of these make the DBMS), the server is a Query engine connecting to clients, examples include: psql (shell for sql commands), python/psycopg2, Java/JDBC, etc.</p>
<p><strong>Note</strong>:</p>
<ul>
<li>Python itself doesn&apos;t have a database link, rather various db links have been created for it, an example listed above; psycopg2.</li>
<li>An <strong>example</strong>: Some program <a href="http://query.py">query.py</a> contains a sql query, it is sent to the server/query engine via the psycopg2 interface, the query engine then runs the query, looks at the data on the disk, formulates an answer to your query, then sent back as a stream of tuples to your terminal window</li>
</ul>
<p>This is how such multiuser databases work i.e. postgreSQl, oracle, mySQL etc.</p>
<p><strong>Non Client-Server architecture</strong>:<br>
SQLite is an example of a non client-server system, rather it has notions of a client and a query engine but they are not seperate from each other.</p>
<p>The <strong>sqlite3</strong> command is a shell in the same sense as psql, it is also compiled with the query engine (seen as a library which is already compiled in with the sqlite shell), which invokes the subsequent commands to the data on the disk, the results are then sent back to the user.</p>
<p>There is also an API defined for use (to ineract with the query engine library) from programming languages, e.g. python</p>
<h4 class="mume-header" id="data-modellings">Data Modellings</h4>

<p>What is it? A design process which converts requirements into a data model<br>
The aims of data modelling are to:</p>
<ul>
<li>Describe the info contained within the db</li>
<li>Describe the relationships between data items</li>
<li>Describes constraints on data</li>
</ul>
<p>There are 2 main kinds of data models. These are logical and physical, the former is abstract and for conceptual design e.g. UML, ER. etc., the latter is record based - tuples, e.g. relational, SQL, etc.</p>
<p>The strategy is to design using an abstract model e.g. ER but then map to a physical model, e.g. SQL schema from relational</p>
<p><img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/data-models/Pics/er-rel/data-modelling.png" alt="Strategy"></p>
<p><strong>Exercise</strong>:<br>
Consider the Gmail system, develop an informal data model for it by identifying the:</p>
<ul>
<li>Data items involved - objects, attributes</li>
<li>Relationships between these data items</li>
<li>Constraints on the data and relationship</li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>Objects:
messages - title, content, sender*, timestamp, ...
users - gmail-address, name, password ...
labels/tags - owner, name, colours, parent*
settings - name, value, user*, ...

Relationships:
sender ... messages - users
recipients ... messages - mail-address
has-label ... messages - labels
hierarchy ... child label - parent label

Constraints:
gmail-addresses are uniqu/distinct
every message has a timestamp
every message has a sender
message content isn&apos;t empty
etc.
</code></pre><p>There is no single &quot;best&quot; design for a given application.</p>
<p>Most important <strong>aspects</strong> of a design (data model):</p>
<ul>
<li>correctness (satisfies requirements accurately)</li>
<li>completeness (all reqs covered, all assumptions explicit)</li>
<li>consistency (no contradictory statements)</li>
</ul>
<p>Potential <strong>inadequacies</strong> in a design:</p>
<ul>
<li>omits information that needs to be included</li>
<li>contains redundant information (&#x21D2; inconsistency)</li>
<li>leads to an inefficient implementation</li>
<li>violates syntactic or semantic rules of data model</li>
</ul>
<hr>
<h4 class="mume-header" id="er-data-modelling">ER Data Modelling:</h4>

<p>The world is viewed as a collection of inter-related entities, ER has 3 major modelling constructs:</p>
<ul>
<li>Attribute: value describing a property of interest</li>
<li>Entity: Collection of attributes describing object of interest, made up of several attributes</li>
<li>Relationship: Association between entitites - objects</li>
</ul>
<p>In an ER diagram, the ovals represents attributes, diamonds are relationships and rectanges are entities. <strong>Arrows</strong> represent unique connections whereas <strong>thick lines</strong> could represent sharing. The underline (keys) and hash represent unique attributes</p>
<p><strong>Key (superkey)</strong> - any set of attributes</p>
<ul>
<li>Indicated in ER diagrams by underlining</li>
<li>Set of values which are distinct over an entity set</li>
<li>Natural (name + address + birthday) or artificial (SSN)</li>
</ul>
<p><strong>Candidate key</strong> - Minimal superkey<br>
<strong>Primary key</strong> - Candidate key chosen by DB designer</p>
<p>Example of identifying keys:<br>
Consider the example of a student, some possibilities are:<br>
studentID, phone, email, (name, addressm d-o-b), etc.</p>
<p>(...)</p>
<p><strong>Subclasses and Inheritance:</strong><br>
A subclass of entity set A is a set of entities:</p>
<ul>
<li>With all attributes of A + its own attributes</li>
<li>Involved in all of A&apos;s relationships</li>
</ul>
<p>Properties of subclasses:</p>
<ul>
<li>Overlapping or disjoint (entity in multiple subclasses?)</li>
<li>Total/partial (does every entity have to also be in a subclass)</li>
</ul>
<p>Examples:<br>
<em>A person may be a doctor and/or patient or neither</em> (Partial participation)<br>
<em>Every employee is either permanent OR works under a contract</em> (Total participation)</p>
<p>A summary:<br>
ER Model is popular for doing conceptual design</p>
<ul>
<li>High level and the models are easy to understand</li>
<li>Good expressive power which can capture many details</li>
</ul>
<p>Basic constructs consist of entities, relationships and attributes</p>
<p>Relational constraints:</p>
<ul>
<li>Total/partial, n:m / 1:n / 1:1</li>
</ul>
<p>Other constructs: Inheritance hierarchies, weak entities</p>
<p>We should also consider that many notational variations of ER exist</p>
<hr>
<h4 class="mume-header" id="relational-model">Relational model:</h4>

<p>Describes the world as <em>a collection of inter-connected relations/tables</em>, the relational model has 1 structuring mechanism: <strong>relations</strong> (used to model both entities and relationships).</p>
<p>Each relation has a unique name within a given database and a set of attributes (column headings).<br>
Each attribute has a unique name within a given relation and an associated domain (set of allowed values)</p>
<p>Consider a relation R with n attributes:</p>
<ul>
<li>A relation schema -&gt; A set of attributes</li>
<li>Tuple -&gt; List of values</li>
<li>Instance of R -&gt; set of tuples</li>
</ul>
<p>An example of an instance of a relation - Account(branchName, accountNo, balance):</p>
<pre data-role="codeBlock" data-info class="language-"><code>{
(Sydney, A-101, 500),
(Coogee, A-215, 700),
(Parramatta, A-102, 400),
(Rouse Hill, A-305, 350),
(Brighton, A-201, 900),
(Kingsford, A-222, 700)
(Brighton, A-217, 750)
}
</code></pre><ul>
<li>Domains are comprised of atomic values - ints, chars, dates, ..</li>
<li>NULL belongs to all domains</li>
<li>Each relation has a key</li>
</ul>
<p><strong>An ER diagram:</strong><br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/rel-model/Pics/er-rel/schemaER.png" alt="ERModel"></p>
<p><strong>Relational schema:</strong><br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/rel-model/Pics/er-rel/schema.png" alt="RSchema"></p>
<p><strong>Example Database Instance</strong>:<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/rel-model/Pics/er-rel/rel-tables.png" alt="Instance"></p>
<p><strong>Integrity contraints:</strong><br>
To represent real-world problems, we will need to describe what <strong>values</strong> are/aren&apos;t allowed and what <strong>combinations</strong> of values are/aren&apos;t allowed.</p>
<p><strong>Constraints</strong> are logical statements which do this:</p>
<ul>
<li>
<p><strong>Domain constraints:</strong> Limit the set of values attributes can take, e.g. Employee.age is typically an integer</p>
</li>
<li>
<p><strong>Key contraints:</strong> Identify attributes that uniquely identify tuples, e.g. Student(id,...) is guaranteed unique, Class(...,day,time,location,...) is unique too</p>
</li>
<li>
<p><strong>Entity integrity</strong> constraints: Require keys to be fully defined, e.g. Class(...,Mon,2pm,Lyre,...) is well-defined but Class(...,NULL,2pm,Lyre,...) is not well-defined</p>
</li>
<li>
<p><strong>Referential integrity</strong> constraints: Require references to other tables to be valid</p>
<ul>
<li>Describe references between relations (tables).</li>
<li>Are related to a notion of a FK - Foreign Key:</li>
<li>A set of attributes F in relation R1 is a <strong>foreign key</strong> for R2 if: The attributes in F correspond to the primary key of R2 and the value F in each tuple in R1 is NULL or occurs as a primary key in R2<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/rel-model/Pics/er-rel/fkeys.png" alt="Keys"><br>
Foreign keys are critical in relational DBs, they provide:
<ul>
<li>The glue that links individual relations</li>
<li>The way to assemble query answers from multiple tables</li>
<li>the relational representation of ER relationships</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Relational DATABASES</strong>:<br>
A relational database schema is:</p>
<ul>
<li>A set of relation schemas {R1, R2, R3,...}</li>
<li>A set of integrity constraints</li>
</ul>
<p>A relational database instance is:</p>
<ul>
<li>Integrity constraints are all satisfied</li>
<li>Set of relation instances {r1(R1), r2(R2), ...}<br>
(SQL / language to express relational schemas)</li>
</ul>
<p>An important note:</p>
<ul>
<li>In relational DBs, all data must satisfy the constraints otherwise data would fail if they were to cause constraint violation</li>
</ul>
<p><strong>Describing relational schemas</strong><br>
Now we want to use a language to express these schemas, SQL provides a Data Definition Language (DDL) for this:</p>
<pre data-role="codeBlock" data-info class="language-"><code>CREATE TABLE TableName (
 attrName1 domain1 constraints1 ,
 attrName2 domain2 constraints2 ,
 ...
 PRIMARY KEY (attri,attrj,...),
 FOREIGN KEY (attrx,attry,...)
             REFERENCES
             OtherTable (attrm,attrn,...), ...
);
</code></pre><hr>
<h4 class="mume-header" id="er-relational-mapping">ER Relational mapping:</h4>

<p>As discussed earlier, a useful strategy for db design is to perfrom the initial data modelling using ER (conceptual), then transforming conceptual design into relational model</p>
<p><strong>Relational Model vs ER Model</strong><br>
Some similarities:</p>
<ul>
<li>attribute(ER) &#x2245; attribute(Rel), entity(ER) &#x2245; tuple(Rel)</li>
<li>entity set(ER) &#x2245; relation(Rel), relationship(ER) &#x2245; relation(Rel)</li>
</ul>
<p>Some differences:</p>
<ul>
<li>Rel uses relations to model entities and relationships</li>
<li>Rel has no composite or multi-valued attributes (only atomic)</li>
<li>Rel has no object-oriented notions (e.g. subclasses, inheritance)</li>
</ul>
<p>Note:<br>
Not all aspects of ER can be represented exactly in a relational schema, as such; Some aspects of relational schemas do NOT appear in ER, e.g. domains</p>
<p><strong>Mapping strong entities</strong><br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/strongent.png" alt="Strong Entity"><br>
Note: They key is preserved in the mapping</p>
<p><strong>Mapping weak entities</strong><br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/mapwkent.png" alt="Weak entity"></p>
<p><strong>Mapping N:M Relationships</strong><br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/mapnnrel.png" alt="N:M relationships"></p>
<ul>
<li>These will generalise to N:M:P:Q if multiple entities are involved</li>
<li>Other multiplicitiesL 1:n:m need to be mapped the same as n:m :p:q</li>
</ul>
<p><strong>Mapping 1:N Relationships</strong><br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/map1nrel2.png" alt="1:N Relationship"></p>
<p><strong>Mapping 1:1 Relationships</strong><br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/map11rel.png" alt="1:1 Relationship"></p>
<p>No reason to favour one side - example:<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/map11rel3.png" alt="1:1 Relationship"></p>
<p><strong>Mapping composite attributes</strong><br>
These are mapped by concatenation or flattening:<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/mapstrent.png" alt="Composite"></p>
<p><strong>Mapping Multi-Valued attributes (MVAs):</strong><br>
These are mapped by a new table linking values to their entity<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/mapmva.png" alt="MVAs"><br>
These then become:<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/mapmva1.png" alt="ERModel"><br>
Further Representation:<br>
The 2 entities:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Person(12345, John, 12-feb-1990, [red,green,blue])
Person(54321, Jane, 25-dec-1990, [green,purple])
</code></pre><p>Would be represented as:</p>
<pre data-role="codeBlock" data-info class="language-"><code>Person(12345, John, 12-feb-1990)
Person(54321, Jane, 25-dec-1990)
FavColour(12345, red)
FavColour(12345, green)
FavColour(12345, blue)
FavColour(54321, green)
FavColour(54321, purple)
</code></pre><p><strong>Mapping Subclasses</strong><br>
There are 3 different approaches to mapping subclasses to tables:</p>
<ul>
<li>ER style:
<ul>
<li>Each entity becomes a seperate table</li>
<li>containing attributes of subclass + FK to superclass table<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/mapsubclass.png" alt="ER style"></li>
</ul>
</li>
<li>Object-oriented
<ul>
<li>Each entity becomes a seperate table</li>
<li>Inheriting all attributes from all superclasses<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/mapsubclass2.png" alt="OO mapping"></li>
</ul>
</li>
<li>Single table with nulls
<ul>
<li>Whole class hierarchy becomes one table</li>
<li>Containing all attributes of all subclasses (NULL if unused)<br>
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-rel-mapping/Pics/er-rel/mapsubclass3.png" alt="Single-table-with-nulls"></li>
</ul>
</li>
</ul>

    </div>
  </body></html>
    <!-- Follwowing parapgraphs -->
    <!-- WEEK02 LECTURE NOTES:-->
    <hr>
  </head>
  <body for="html-export">
    <div class="mume markdown-preview  ">
    <h2 class="mume-header" id="week-2">Week 2</h2>

<h4 class="mume-header" id="sql-vs-relational-model">SQL vs Relational Model:</h4>

<p>The relational model is a formal system for describing and manipulating data whereas SQL is a programming language for describing and manipulating data.</p>
<p>SQL extends the relational model in some ways but it also omits some aspects of the model i.e. some constraints.</p>
<h4 class="mume-header" id="some-sql-history">Some SQL History:</h4>

<p>Standardized in 1986 but developed at IBM in mid 1970s<br>
Many DBMSs have been built around SQL: System-R, Oracle, Ingres, ...</p>
<p>SQL has several sub-languages:</p>
<ul>
<li>Meta data definition language i.e. create table</li>
<li>Meta data update language (modify the objects) i..e drop table</li>
<li>Data update language i.e insert, update,...</li>
<li>Query language i..e select ... from .. where</li>
</ul>
<h4 class="mume-header" id="sql-syntax">SQL Syntax</h4>

<p>Syntax-wise it is similar to other languages:</p>
<ul>
<li>Has keywords, constants, etc.</li>
<li>Differs with strings compared to other PLs
<ul>
<li>&apos;...&apos; are constant strings e.g. &apos;a&apos;, aabc&apos;, &apos;john&apos;&apos;s bag&apos;</li>
<li>&quot;...&quot; allow non-alpha chars in <strong>identifiers</strong> and make ID&apos;s case sensitive</li>
</ul>
</li>
</ul>
<p>In the standard, all non-quoted identifiers map to upper case (not in PostgreSQL -&gt; maps to lower case).</p>
<ul>
<li>e.g. BankBranches = bankbranches are treated as BANKBRANCHES, this is not applied if they were to be wrapped in double quotes</li>
</ul>
<p>Definitions, queries and statements are composed of:</p>
<ul>
<li>Comments ... --comment to end of line</li>
<li>identifiers (db objects such as tables, attributes, views,...Also meta objects such as types, functions, constraints,...) ... similar to regular PLs</li>
<li>keywords ... a large set (e.g. CREATE, DROP, TABLE)</li>
<li>data types ... small set of basic types - integer, date, etc.</li>
<li>operators &amp; constants .. similar to regular PLs e.g. =, &lt;&gt;, &lt;, &lt;=, &gt;, &gt;=, AND, OR, NOT, ...</li>
</ul>
<p><strong>Names in SQL:</strong><br>
Naming conventions:</p>
<ul>
<li>relation names: e.g. Branches, Students, ... (use plurals)</li>
<li>attribute names: e.g. name, code, firstName, ...</li>
<li>foreign keys: named after either or both of
<ul>
<li>table being referenced e.g. staff or staff_id, ...</li>
<li>relationship being modelled e.g. teaches, ...</li>
</ul>
</li>
</ul>
<p><strong>Types and constants:</strong><br>
Numeric types: INTEGER, REAL, NUMERIC(w,d)<br>
<code>10 -1 3.14159 2e-5 6.022e23</code><br>
String types: CHAR(n), VARCHAR(n), TEXT<br>
<code>&apos;John&apos; &apos;some text&apos; &apos;!%#%!$&apos; &apos;O&apos;&apos;Brien&apos; &apos;&quot;&apos; &apos;[A-Z]{4}\d{4}&apos; &apos;a VeRy! LoNg String&apos;</code><br>
PostgreSQL&apos;s extended strings with &apos;&apos; escapes:<br>
<code>E&apos;\n&apos; E&apos;O\&apos;Brien&apos; E&apos;[A-Z]{4}\\d{4}&apos; E&apos;John&apos;</code><br>
Type casting by using <code>Expr::Type</code>:<br>
<code>e.g. &apos;10&apos;::integer</code><br>
Logical Types: BOOLEAN, TRUE and FALSE (or true and false)<br>
Time related types: DATE, TIME, TIMESTAMP, INTERVAL<br>
<code>&apos;2008-04-13&apos; &apos;13:30:15&apos; &apos;2004-10-19 10:23:54&apos; &apos;Wed Dec 17 07:37:16 1997 PST&apos; &apos;10 minutes&apos; &apos;5 days, 6 hours, 15 seconds&apos;</code><br>
PostgreSQL&apos;s non-standard types: geometric (point/line/...), currency, IP addresses, JSON, XML, objectIDs, ...</p>
<p>Users defining their own types:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- domains: constrained version of existing type</span>

<span class="token keyword">CREATE</span> DOMAIN Name <span class="token keyword">AS</span> <span class="token keyword">Type</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span> <span class="token keyword">Constraint</span> <span class="token punctuation">)</span>

<span class="token comment">-- tuple types: defined for each table</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TYPE</span> Name <span class="token keyword">AS</span> <span class="token punctuation">(</span> AttrName AttrType<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>

<span class="token comment">-- enumerated type: specify elements and ordering</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TYPE</span> Name <span class="token keyword">AS</span> <span class="token keyword">ENUM</span> <span class="token punctuation">(</span> <span class="token string">&apos;Label&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
</pre><p><strong>Defining Domains/Types</strong>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- positive integers</span>
<span class="token keyword">CREATE</span> DOMAIN PosInt <span class="token keyword">AS</span> <span class="token keyword">integer</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- a UNSW course code</span>
<span class="token keyword">CREATE</span> DOMAIN CourseCode <span class="token keyword">AS</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
  <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">~</span> <span class="token string">&apos;[A-Z]{4}[0-9]{4}&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- a UNSW student/staff ID</span>
<span class="token keyword">CREATE</span> DOMAIN ZID <span class="token keyword">AS</span> <span class="token keyword">integer</span>
  <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token keyword">value</span> betweem <span class="token number">1000000</span> <span class="token operator">and</span> <span class="token number">9999999</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- standard UNSW grades (FL,PS,CR,DN,HD)</span>
<span class="token keyword">CREATE</span> DOMAIN Grade <span class="token keyword">AS</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&apos;FL&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;PS&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;CR&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;DN&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;HD&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- or</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TYPE</span> Grade <span class="token keyword">AS</span> <span class="token keyword">ENUM</span> <span class="token punctuation">(</span><span class="token string">&apos;FL&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;PS&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;CR&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;DN&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;HD&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Tuples and set literals</strong><br>
Tuple and set constants are both written as:</p>
<p><code>( val1, val2, val3, ... )</code></p>
<p>Examples:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Student<span class="token punctuation">(</span>studeID<span class="token punctuation">,</span> name<span class="token punctuation">,</span> degree<span class="token punctuation">)</span>
 <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2177364</span><span class="token punctuation">,</span> <span class="token string">&apos;Jack Smith&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;BSc&apos;</span><span class="token punctuation">)</span>
        <span class="token comment">-- tuple literal</span>

<span class="token keyword">CONSTRAINT</span> <span class="token keyword">CHECK</span> gender <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">&apos;male&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;female&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;unspecified&apos;</span><span class="token punctuation">)</span>
                         <span class="token comment">-- set literal</span>
</pre><h4 class="mume-header" id="sql-expressions">SQL expressions:</h4>

<p>Expressions in SQL involve: objects, constants, operators</p>
<ul>
<li>Objects are typically names of attributes (or PLpgSQL variables)</li>
<li>Operators may be symbols (e.g. +, =) or keywords (e.g. between)</li>
<li>Constants are similar to other PLs</li>
<li>Strings as discussed before are quite different &apos;...&apos; rather than &quot;...&quot; and no \n escape chars (besides non-standards) and dollar quoting: <span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>O</mi><mo mathvariant="normal" lspace="0em" rspace="0em">&#x2032;</mo></msup><mi>B</mi><mi>r</mi><mi>i</mi><mi>e</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">O&apos;Brien</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.801892em;vertical-align:0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.801892em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">&#x2032;</span></span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.05017em;">B</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">i</span><span class="mord mathdefault">e</span><span class="mord mathdefault">n</span></span></span></span></span> or <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">tag</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span>O&apos;Brien<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>a</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">tag</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span></span></li>
</ul>
<p><strong>Operators</strong>:<br>
Comparison: <code>&lt; &gt; &lt;= &gt;= = &lt;&gt;</code>, PostgreSQL has != but no ==, We also use: <code>AND, OR, NOT</code><br>
Note: String comparison (e.g. str1 &lt; str2) uses dictionary order</p>
<p>Other:<br>
SQL provides pattern matching with LIKE, NOT LIKE used in conjunction with %, _:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">name <span class="token operator">LIKE</span> <span class="token string">&apos;Ja%&apos;</span>		<span class="token comment">--name begins with &apos;Ja&apos;</span>
name <span class="token operator">LIKE</span> <span class="token string">&apos;_i%&apos;</span>		<span class="token comment">--name has &apos;i&apos; as 2nd letter</span>
name <span class="token operator">LIKE</span> <span class="token string">&apos;%o%o%&apos;</span>	<span class="token comment">--name contains two &apos;o&apos;s</span>
name <span class="token operator">LIKE</span> <span class="token string">&apos;%ith&apos;</span>	<span class="token comment">--name ends with &apos;ith&apos;</span>
name <span class="token operator">LIKE</span> <span class="token string">&apos;John&apos;</span>	<span class="token comment">--name equals &apos;John&apos;</span>
</pre><p>We can also use regexp-based pattern matching (~, !~):</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">name <span class="token operator">~</span> <span class="token string">&apos;^Ja&apos;</span>		<span class="token comment">--name begins with &apos;Ja&apos;</span>
name <span class="token operator">~</span> <span class="token string">&apos;^.i&apos;</span>		<span class="token comment">--name has &apos;i&apos; as 2nd letter</span>
name <span class="token operator">~</span> <span class="token string">&apos;.*o.*o.*&apos;</span>	<span class="token comment">--name contains two &apos;o&apos;s</span>
name <span class="token operator">~</span> <span class="token string">&apos;ith$&apos;</span>		<span class="token comment">--name ends with &apos;ith&apos;</span>
name <span class="token operator">~</span> <span class="token string">&apos;John&apos;</span>		<span class="token comment">--name contains &apos;John&apos;</span>
</pre><p>We should consult our local SQL manual for other operators and functions e.g.</p>
<ul>
<li>str1 || str2 ... return concatenation of str1 and str2</li>
<li>lower(str) ... return lower-case version of str</li>
<li>substring(str,start,count) ... extract substring from str</li>
<li>Arithmetic operators: <code>+ - * / abs ceil floor power sqrt sin etc.</code></li>
<li>Aggregations:
<ul>
<li>count(attr) ... number of rows in attr column</li>
<li>sum(attr) ... sum of values for attr</li>
<li>avg(attr) ... mean of values for attr</li>
<li>min/max(attr) ... min/max of values for attr</li>
</ul>
</li>
</ul>
<p><strong>Conditional expressions:</strong><br>
We test for NULL with <code>x IS NULL</code> OR <code>x IS NOT NULL</code><br>
Other ways to handle NULL:<br>
<code>coalesce(val1,val2,...valn)</code>:</p>
<ul>
<li>This returns first non-null value</li>
</ul>
<p>E.g.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">select</span> <span class="token keyword">coalesce</span><span class="token punctuation">(</span>mark<span class="token punctuation">,</span><span class="token string">&apos;??&apos;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> Marks <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</pre><p><code>nullif(val1,val2)</code>:</p>
<ul>
<li>This returns NULL if val1 == val2</li>
</ul>
<p>E.g.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">nullif</span><span class="token punctuation">(</span>mark<span class="token punctuation">,</span><span class="token string">&apos;??&apos;</span><span class="token punctuation">)</span>
</pre><p>SQL also provides a generalized conditional expression:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CASE</span>
 <span class="token keyword">WHEN</span> test1 <span class="token keyword">THEN</span> result1
 <span class="token keyword">WHEN</span> test2 <span class="token keyword">THEN</span> result2
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token keyword">ELSE</span> result_n
<span class="token keyword">END</span>
</pre><p>E.g. case when mark&gt;=85 then &apos;HD&apos; ... else &apos;??&apos; end</p>
<p>Tests that yield NULL are treated as FALSE</p>
<p>If no ELSE, and all tests fail, CASE yields NULL</p>
<h4 class="mume-header" id="sql-data-definition-language">SQL Data Definition Language</h4>

<p>Relation schema: Defines an individual table (consisting of table name, attribute names, attribute domains, keys, ...)</p>
<p>Database schema: A collection of Relation schemas (defines structure of the whole db and additional constraints).</p>
<p>Given an informal schema:</p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/sql-ddl/Pics/sql/uni-rschema.png">
</p>
Our database needs more than what we have provided above (relation names, attr names, PKs, FKs). SQL has a DDL which can describe table names, names/domains for attrs, various constraint  types.
<p>A simple stucture:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TableName <span class="token punctuation">(</span>
  attribute1   domain1   constraints1<span class="token punctuation">,</span>
  attribute2   domain2   constraints2<span class="token punctuation">,</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">table</span><span class="token operator">-</span><span class="token keyword">level</span> constraints<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
<span class="token comment">-- Remove table with: DROP TABLE TableName;</span>
</pre><p>Defining the <strong>students</strong> table:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Students <span class="token punctuation">(</span>
  zid     <span class="token keyword">serial</span><span class="token punctuation">,</span>
  family  <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  given   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  d_o_b   <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  gender  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>gender <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;F&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  degree  <span class="token keyword">integer</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>zid<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>degree<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Degrees<span class="token punctuation">(</span>did<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- This has much more info than the relation schema</span>
</pre><p>Alternative example:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> DOMAIN GenderType <span class="token keyword">AS</span>
     <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;F&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Students <span class="token punctuation">(</span>
  zid     <span class="token keyword">serial</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
          <span class="token comment">-- only works if primary key is one attr</span>
  family  <span class="token keyword">text</span><span class="token punctuation">,</span>  <span class="token comment">-- no need to worry about max length</span>
  given   <span class="token keyword">text</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  d_o_b   <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  gender  GenderType<span class="token punctuation">,</span>
  degree  <span class="token keyword">integer</span> <span class="token keyword">REFERENCES</span> Degrees<span class="token punctuation">(</span>did<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Defining the <strong>courses</strong> table:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Courses <span class="token punctuation">(</span>
  cid    <span class="token keyword">serial</span><span class="token punctuation">,</span>
  code   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> uhs <span class="token comment">-- uses regexp</span>
                 <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>code <span class="token operator">~</span> <span class="token string">&apos;[A-Z]{4}[0-9]{4}&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  term   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
                 <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>term <span class="token operator">~</span> <span class="token string">&apos;[0-9]{2}T[0-3]&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  title  <span class="token keyword">text</span> <span class="token keyword">UNIQUE</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>cid<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Defining the <strong>Enrolments</strong> <em>relationship</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Enrolments <span class="token punctuation">(</span>
  student <span class="token keyword">integer</span><span class="token punctuation">,</span>
  course  <span class="token keyword">integer</span><span class="token punctuation">,</span>
  mark    <span class="token keyword">integer</span> <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>mark <span class="token operator">BETWEEN</span> <span class="token number">0</span> <span class="token operator">AND</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  grade   GradeType<span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>student<span class="token punctuation">,</span>course<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>student<span class="token punctuation">)</span>
                <span class="token keyword">REFERENCES</span> Students<span class="token punctuation">(</span>zid<span class="token punctuation">)</span>
  <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>course<span class="token punctuation">)</span>
                <span class="token keyword">REFERENCES</span> Courses<span class="token punctuation">(</span>cid<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Data Integrity</strong>:<br>
Constraints and types ensure that integrity of data is preserved i.e. No duplicate keys, attributes have valid values, etc... This is critical function of a DBMS</p>
<p><strong>Another example</strong>:</p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/sql-ddl/Pics/sql/bank-rschema.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Accounts <span class="token punctuation">(</span>
  acctNo  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
  branch  <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Branches<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                      <span class="token keyword">DEFAULT</span> <span class="token string">&apos;Central&apos;</span><span class="token punctuation">,</span>
  owner   <span class="token keyword">integer</span> <span class="token keyword">REFERENCES</span> Customers<span class="token punctuation">(</span>custID<span class="token punctuation">)</span><span class="token punctuation">,</span>
  balance <span class="token keyword">float</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.0</span> <span class="token comment">-- Set as DEFAULT 0.0</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Accounts<span class="token punctuation">(</span>acctNo<span class="token punctuation">,</span>owner<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&apos;A-456&apos;</span><span class="token punctuation">,</span><span class="token number">645342</span><span class="token punctuation">)</span>
<span class="token comment">-- produces the tuple</span>
Accounts<span class="token punctuation">(</span><span class="token string">&apos;A-456&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;Central&apos;</span><span class="token punctuation">,</span> <span class="token number">645342</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span>
</pre><p><strong>Defining Keys:</strong><br>
<strong>Primary keys</strong> imply NOT NULL UNIQUE for all attributes in key, if it is 1 attr, then defined as attr constraint else defined in table constraint.</p>
<p><strong>Foreign Keys</strong>, can omit the FOREIGN KEY keywords in attr constraint, we should always specify the corresponding PK attr in FK constraint e.g.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql">customer <span class="token keyword">integer</span>
      <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token keyword">REFERENCES</span> Customers<span class="token punctuation">(</span>customerNo<span class="token punctuation">)</span>
</pre><p>Example of fails:</p>
<ul>
<li>Defining primary keys assures entity integrity, below fails because no course specified</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Enrolments<span class="token punctuation">(</span>student<span class="token punctuation">,</span>course<span class="token punctuation">,</span>mark<span class="token punctuation">,</span>grade<span class="token punctuation">)</span>
     <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5123456</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><ul>
<li>Defining foreign keys assures referential integrity. Below fails if no customer with given ID or branch &apos;nowhere&apos;</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Accounts<span class="token punctuation">(</span>acctNo<span class="token punctuation">,</span> owner<span class="token punctuation">,</span> branch<span class="token punctuation">,</span> balance<span class="token punctuation">)</span>
          <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&apos;A-123&apos;</span><span class="token punctuation">,</span> <span class="token number">765432</span><span class="token punctuation">,</span> <span class="token string">&apos;Nowhere&apos;</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Deletion is a bit more tricky because tuples refer to other tuples, in such cases we could: 1. Reject the deletion (Common method), 2. set-NULL the FKs in account records, 3. Cascade the deletion then remove Acct records (BAD)</p>
<p><strong>Attribute value constraints</strong><br>
NOT NULL and UNIQUE are special constraints on attributes.<br>
We use the below mechanism for specifying <strong>attribute constraints</strong>:<br>
<code>attrName type CHECK ( Condition )</code> where condition is a boolean expression<br>
Example:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Example
<span class="token punctuation">(</span>
 gender <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>gender <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;F&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 Xvalue <span class="token keyword">integer</span>  <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 Yvalue <span class="token keyword">integer</span>  <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Yvalue <span class="token operator">&gt;</span> Xvalue<span class="token punctuation">)</span><span class="token punctuation">,</span>
 Zvalue <span class="token keyword">float</span>    <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Zvalue <span class="token operator">&gt;</span>
                        <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span>
                         <span class="token keyword">FROM</span>   Sells<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>Constraint in an SQL table can be optionally <em>named</em><br>
<code>CONSTRAINT constraintName constraint</code></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Example
<span class="token punctuation">(</span>
 gender <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">CONSTRAINT</span> GenderCheck
                <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>gender <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;F&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 Xvalue <span class="token keyword">integer</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 Yvalue <span class="token keyword">integer</span> <span class="token keyword">CONSTRAINT</span> XYOrder
                <span class="token keyword">CHECK</span> <span class="token punctuation">(</span>Yvalue <span class="token operator">&gt;</span> Xvalue<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4 class="mume-header" id="relational-database-management-systems">Relational Database Management Systems:</h4>

<p>RDBMS is a software designed to support large scale data intensive apps, allows for a high level description of the data. We have high-level access/retrieval to this data that is stored efficiently. It supports multiple simultaneous users and operations. It is also maintains reliable access to the stored data, DBs provide persistent storage</p>
<p>In this course, we will be using PostgreSQL (client-server DBMS) and SQLite (serverless DBMS)</p>
<p><strong>Managing databases:</strong><br>
Shell commands to <em>create/remove</em> dbs:</p>
<ul>
<li><code>createdb dbname</code> ... create a new totally empty database</li>
<li><code>dropdb dbname</code> ... remove all data associated with a DB</li>
</ul>
<p>Shell commands to <em>dump/restore</em> database contents:</p>
<ul>
<li><code>pg_dump dbname &gt; dumpfile</code></li>
<li><code>psql dbname -f dumpfile</code></li>
</ul>
<p><strong>Managing tables:</strong></p>
<p>SQL statements:</p>
<p><code>CREATE TABLE table ( Attributes+Constraints )</code><br>
<code>ALTER TABLE table TableSchemaChanges</code><br>
<code>DROP TABLE table(s) [ CASCADE ]</code><br>
<code>TRUNCATE TABLE table(s) [ CASCADE ]</code></p>
<p>Note: The TRUNCATE TABLE command deletes the data inside a table, but not the table itself.</p>
<p>The CASCADE keyword will:</p>
<ul>
<li>Drop objects with DROP keyword</li>
<li>Truncates tables with TRUNCATE keyword</li>
</ul>
<p><strong>Managing Tuples</strong><br>
SQL statements:</p>
<ul>
<li><code>INSERT INTO table ( Attrs ) VALUES Tuple(s)</code></li>
<li><code>DELETE FROM table WHERE condition</code></li>
<li><code>UPDATE table SET AttrValueChanges WHERE condition</code></li>
</ul>
<p>Note:</p>
<ul>
<li><code>Attrs = ( attr1,, ... attrn )</code> and <code>Tuple = ( val1,, ... valn )</code></li>
<li>AttrValueChanges is a comma-separated list of: attrnames which are expressions (Each list element assigns a new value to a given attribute).</li>
</ul>
<p>Example below:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Student <span class="token punctuation">(</span>
  zid     <span class="token keyword">serial</span><span class="token punctuation">,</span> <span class="token comment">-- Automatically geenrates unique integer values</span>
  family  <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  given   <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  d_o_b   <span class="token keyword">date</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  gender  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">check</span> <span class="token punctuation">(</span>gender <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&apos;M&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;F&apos;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  degree  <span class="token keyword">integer</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>zid<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>degree<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> Degrees<span class="token punctuation">(</span>did<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><h4 class="mume-header" id="mapping-er-to-sql">Mapping ER to SQL:</h4>

<p>SQL schemas are essentially more detailed versions of relational schemas.</p>
<p>The mapping is much the same, except that</p>
<ul>
<li>You need to provide more details on allowed values</li>
<li>You can map some ideas from ER that are not in relational schemas</li>
</ul>
<p>Differences between SQL and ER models:</p>
<ul>
<li>SQL uses tables to model entities and relationships</li>
<li>SQL has no composite or multi-valued attributes (only atomic)</li>
<li>SQL has no object-oriented notions (e.g. subclasses, inheritance)</li>
</ul>
<p><strong>EXAMPLES</strong>:<br>
<strong>Mapping strong entities:</strong></p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-sql/strongent.png">
</p>
<p><strong>Mapping weak entities:</strong></p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-sql/mapwkent.png">
</p>
<p><strong>Mapping N:M Relationships</strong>:</p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-rel/mapnnrel.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> Customers <span class="token punctuation">(</span>
  custNo  <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name    <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  address <span class="token keyword">text</span>  <span class="token comment">-- don&apos;t need to know customer&apos;s address</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Accounts <span class="token punctuation">(</span>
  acctNo   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">check</span> <span class="token punctuation">(</span>acctNo <span class="token operator">~</span> <span class="token string">&apos;[A-Z]-[0-9]{3}&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  title    <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>    <span class="token comment">-- acctNos are like &apos;A-123&apos;</span>
  balance  <span class="token keyword">float</span> <span class="token keyword">default</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>acctNo<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Owns <span class="token punctuation">(</span>
  customer_id <span class="token keyword">integer</span> <span class="token keyword">references</span> Customers<span class="token punctuation">(</span>custNo<span class="token punctuation">)</span><span class="token punctuation">,</span>
  account_id  <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">references</span> Accounts<span class="token punctuation">(</span>acctNo<span class="token punctuation">)</span><span class="token punctuation">,</span>
  last_accessed <span class="token keyword">timestamp</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>customer_id<span class="token punctuation">,</span> account_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Mapping 1:N Relationships</strong></p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-rel/map1nrel2.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> Branches <span class="token punctuation">(</span>
  branchNo <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  address  <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  assets   currency
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Customers <span class="token punctuation">(</span>
  custNo  <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name    <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  address <span class="token keyword">text</span><span class="token punctuation">,</span>
  hasHome <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token comment">-- total participation</span>
  joined  <span class="token keyword">date</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>hasHome<span class="token punctuation">)</span> <span class="token keyword">references</span> Branches<span class="token punctuation">(</span>branchNo<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><hr>
<p><strong>Mapping 1:1 Relationships</strong></p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-rel/map11rel.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> Branches <span class="token punctuation">(</span>
  branchNo <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  address  <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  assets   currency          <span class="token comment">-- a new branch</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>                             <span class="token comment">--    may have no accounts</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Managers <span class="token punctuation">(</span>
  empNo    <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name     <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  salary   currency <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token comment">-- when first employed,</span>
                              <span class="token comment">--    must have a salary</span>
  manages  <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>  <span class="token comment">-- total participation</span>
  <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>manages<span class="token punctuation">)</span> <span class="token keyword">references</span> Branches<span class="token punctuation">(</span>branchNo<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><hr>
<p><strong>Mapping n-way Relationships</strong></p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-sql/map-n-way.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> Customers <span class="token punctuation">(</span>
  custNo   <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Accounts <span class="token punctuation">(</span>
  acctNo   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> ATMs <span class="token punctuation">(</span>
  atmID    <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  cash     currency <span class="token keyword">check</span> <span class="token punctuation">(</span>cash <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  location <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Withdrawal <span class="token punctuation">(</span>
  customer_id  <span class="token keyword">integer</span> <span class="token keyword">references</span> Customers<span class="token punctuation">(</span>custNo<span class="token punctuation">)</span><span class="token punctuation">,</span>
  account_id   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token keyword">references</span> Accounts<span class="token punctuation">(</span>acctNo<span class="token punctuation">)</span><span class="token punctuation">,</span>
  atm_id       <span class="token keyword">integer</span> <span class="token keyword">references</span> ATMs<span class="token punctuation">(</span>atmID<span class="token punctuation">)</span><span class="token punctuation">,</span>
  amount       currency <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token keyword">when</span>         <span class="token keyword">timestamp</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span>  <span class="token punctuation">(</span>customer_id<span class="token punctuation">,</span>account_id<span class="token punctuation">,</span>atm_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><hr>
<p><strong>Mapping Composite Attributes</strong></p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-rel/mapstrent.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- Version 1: concatenated</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> People <span class="token punctuation">(</span>
  ssn     <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name    <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  address <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- Version 2: flattened</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> People <span class="token punctuation">(</span>
  ssn     <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  given   <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  family  <span class="token keyword">text</span><span class="token punctuation">,</span>
  number  <span class="token keyword">integer</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  street  <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  suburb  <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  pcode   <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">check</span> <span class="token punctuation">(</span>pcode <span class="token operator">~</span> <span class="token string">&apos;[0-9]{4}&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><hr>
<p><strong>Mapping Multi-valued Attributes (MVAs)</strong></p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-rel/mapmva.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> People <span class="token punctuation">(</span>
  ssn      <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name     <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  birthday <span class="token keyword">date</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> FavColour <span class="token punctuation">(</span>
  person_id <span class="token keyword">integer</span> <span class="token keyword">references</span> People<span class="token punctuation">(</span>ssn<span class="token punctuation">)</span><span class="token punctuation">,</span>
  colour    <span class="token keyword">text</span><span class="token punctuation">,</span>
  <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>person_id<span class="token punctuation">,</span>colour<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><hr>
<p><strong>Mapping Subclasses</strong><br>
The preferred approach out of the 3 is: ER Style</p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-rel/mapsubclass.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> People <span class="token punctuation">(</span>
  ssn     <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name    <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  address <span class="token keyword">text</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Employees <span class="token punctuation">(</span>
  person_id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  salary    currency <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  position  <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>person_id<span class="token punctuation">)</span> <span class="token keyword">references</span> People<span class="token punctuation">(</span>ssn<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Managers <span class="token punctuation">(</span>
  employee_id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  bonus       currency<span class="token punctuation">,</span>
  <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>employee_id<span class="token punctuation">)</span>
              <span class="token keyword">references</span> Employees<span class="token punctuation">(</span>person_id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>MORE on mapping subclasses:</strong></p>
<p align="center">
<img src="https://cgi.cse.unsw.edu.au/~cs3311/20T3/lectures/er-sql-mapping/Pics/er-sql/map-disjoint.png">
</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> Employees <span class="token punctuation">(</span>
  empID   <span class="token keyword">serial</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  name    <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  address <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Permanents <span class="token punctuation">(</span>
  employee_id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  salary      currency <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>employee_id<span class="token punctuation">)</span> <span class="token keyword">references</span> Employees<span class="token punctuation">(</span>empID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> Casuals <span class="token punctuation">(</span>
  employee_id <span class="token keyword">integer</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>
  pay_rate    currency <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>employee_id<span class="token punctuation">)</span> <span class="token keyword">references</span> Employees<span class="token punctuation">(</span>empID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p>NOTE: This doesn&apos;t capture participation or disjoint-ness</p>

    </div>
  </body></html>
    <!-- WEEK03 LECTURE NOTES-->
    <!-- WEEK4 LECTURE NOTES-->

  </head>
  <body for="html-export">
    <div class="mume markdown-preview  ">
    <h2 class="mume-header" id="updating-queries-and-views">Updating, Queries and Views:</h2>

<p><strong>Updates</strong>:</p>
<p>Allows us to modify specified attributes in a specified tuples of a relation e.g.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">UPDATE</span> R
<span class="token keyword">SET</span>    list <span class="token keyword">of</span> assignments
<span class="token keyword">WHERE</span>  Condition
<span class="token comment">------------------------------</span>
<span class="token comment">-- EXAMPLE 1: Adam changes his phone number.</span>
<span class="token keyword">UPDATE</span> Drinkers
<span class="token keyword">SET</span>    phone <span class="token operator">=</span> <span class="token string">&apos;9385-2222&apos;</span>
<span class="token keyword">WHERE</span>  name <span class="token operator">=</span> <span class="token string">&apos;Adam&apos;</span><span class="token punctuation">;</span>
<span class="token comment">------------------------------</span>
<span class="token comment">-- EXAMPLE 2: John moves to Coogee.</span>
<span class="token keyword">UPDATE</span> Drinkers
<span class="token keyword">SET</span>    addr <span class="token operator">=</span> <span class="token string">&apos;Coogee&apos;</span><span class="token punctuation">,</span>
     phone <span class="token operator">=</span> <span class="token string">&apos;9665-4321&apos;</span>
<span class="token keyword">WHERE</span>  name <span class="token operator">=</span> <span class="token string">&apos;John&apos;</span><span class="token punctuation">;</span>
</pre><p>We can also update many tuples at once:<br>
<em>Example: Make $3 the maximum price for beer.</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">UPDATE</span> Sells
<span class="token keyword">SET</span>    price <span class="token operator">=</span> <span class="token number">3.00</span>
<span class="token keyword">WHERE</span>  price <span class="token operator">&gt;</span> <span class="token number">3.00</span><span class="token punctuation">;</span>
</pre><p><em>Example: Increase beer prices by 10%.</em></p>
<pre data-role="codeBlock" data-info class="language-"><code>UPDATE Sells
SET    price = price * 1.10;
</code></pre><p><strong>Changing Tables:</strong><br>
We use the <em>ALTER TABLE</em> operation:<br>
<code>ALTER TABLE Relation Modifications</code><br>
Some possible modifications:</p>
<ul>
<li>Adding a new column</li>
<li>Change the properties of an exiting attribute</li>
<li>Removing an attribute</li>
</ul>
<p>Below are some <strong>examples</strong>:</p>
<p><em>Example: Add phone numbers for hotels.</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Bars
  <span class="token keyword">ADD</span> phone <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">&apos;Unlisted&apos;</span>
</pre><p>This adds a new column to the table and sets default value to <code>Unlisted</code></p>
<p>We can then use <strong>UPDATE</strong> to add specific phone numbers, as below:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">UPDATE</span> Bars
<span class="token keyword">SET</span>    phone <span class="token operator">=</span> <span class="token string">&apos;9665-0000&apos;</span>
<span class="token keyword">WHERE</span>  name <span class="token operator">=</span> <span class="token string">&apos;Coogee Bay Hotel&apos;</span><span class="token punctuation">;</span>
</pre><h4 class="mume-header" id="sql-queries">SQL Queries:</h4>

<p>A <em>query</em> is a declarative program that retrieves data from a database. They are used in 2 ways:</p>
<ul>
<li>Interactively in e.g. psql</li>
<li>By a program in e.g. PLpgSQL</li>
</ul>
<p><em>SELECT</em> is the most common used SQL Query, the result is a relation displayed on output:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> attributes
<span class="token keyword">FROM</span>   relations
<span class="token keyword">WHERE</span>  condition
</pre><p>Consider some <em>examples</em> below:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> Name <span class="token keyword">FROM</span> Beers <span class="token keyword">WHERE</span> Manf <span class="token operator">=</span> <span class="token string">&apos;Toohey&apos;&apos;s&apos;</span><span class="token punctuation">;</span>
</pre><p>Returns a subset of the Beers relation, shown as output:</p>
<pre data-role="codeBlock" data-info class="language-"><code>    name
-------------
New
Old
Red
Sheaf Stout
</code></pre><p>Some semantics of <em>SELECT</em>:</p>
<pre data-role="codeBlock" data-info class="language-"><code>FOR EACH tuple T in R DO
  check whether T satisfies the condition
                      in the WHERE clause
  IF it does THEN
      print the attributes of T that are
          specified in the SELECT clause
  END
END
</code></pre><p>NOTE: Select multiple/all attributes (use * for all):</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> Name<span class="token punctuation">,</span> Addr <span class="token keyword">FROM</span> Drinkers<span class="token punctuation">;</span>

name  <span class="token operator">|</span>   addr
<span class="token comment">--------+----------</span>
Adam   <span class="token operator">|</span> Randwick
Gernot <span class="token operator">|</span> Newtown
John   <span class="token operator">|</span> Clovelly
Justin <span class="token operator">|</span> Mosman
</pre><p><strong>Renaming with &quot;AS&quot;:</strong><br>
Use the AS clause within SELECT to rename attributes/relations, example below:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- Example: rename Beers(name,manf) to Beers(beer,brewer)</span>


<span class="token keyword">SELECT</span> name <span class="token keyword">AS</span> beer<span class="token punctuation">,</span> manf <span class="token keyword">AS</span> Brewer
<span class="token keyword">FROM</span> Beers<span class="token punctuation">;</span>

      beer         <span class="token operator">|</span>    brewer
<span class="token comment">---------------------+---------------</span>
<span class="token number">80</span><span class="token operator">/</span><span class="token operator">-</span>                <span class="token operator">|</span> Caledonian
Bigfoot Barley Wine <span class="token operator">|</span> Sierra Nevada
Burragorang Bock    <span class="token operator">|</span> George IV Inn
Crown Lager         <span class="token operator">|</span> Carlton
Fosters Lager       <span class="token operator">|</span> Carlton
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</pre><p>Note:</p>
<ul>
<li>We can also introduce computed values with AS, see example below:</li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>-- Example: display beer prices in Yen, rather than dollars


SELECT bar, beer, price*120 AS PriceInYen  FROM Sells;

     bar        |       beer       |    priceinyen
------------------+------------------+------------------
Australia Hotel  | Burragorang Bock |              420
Coogee Bay Hotel | New              |              270
Coogee Bay Hotel | Old              |              300
Coogee Bay Hotel | Sparkling Ale    | 335.999994277954
Coogee Bay Hotel | Victoria Bitter  | 275.999994277954
Lord Nelson      | Three Sheets     |              450
Lord Nelson      | Old Admiral      |              450
...
</code></pre><ul>
<li>We can also do the same thing with text e.g.</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> drinker<span class="token punctuation">,</span> <span class="token string">&apos;likes Cooper&apos;&apos;s&apos;</span> <span class="token keyword">AS</span> WhoLikes
<span class="token keyword">FROM</span> Likes
<span class="token keyword">WHERE</span> beer <span class="token operator">=</span> <span class="token string">&apos;Sparkling Ale&apos;</span><span class="token punctuation">;</span>

drinker <span class="token operator">|</span>    wholikes
<span class="token comment">---------+----------------</span>
Gernot  <span class="token operator">|</span> likes Cooper<span class="token string">&apos;s
Justin  | likes Cooper&apos;</span>s
</pre><ul>
<li>Our selections can be quite specific too, see below:</li>
</ul>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> price
<span class="token keyword">FROM</span>   Sells
<span class="token keyword">WHERE</span>  bar <span class="token operator">=</span> <span class="token string">&apos;Regent Hotel&apos;</span> <span class="token operator">AND</span> beer <span class="token operator">=</span> <span class="token string">&apos;New&apos;</span><span class="token punctuation">;</span>

price
<span class="token comment">-------</span>
 <span class="token number">2.2</span>

<span class="token comment">-- Note, we can format this better with the statement:</span>

<span class="token keyword">SELECT</span> to_char<span class="token punctuation">(</span>price<span class="token punctuation">,</span><span class="token string">&apos;$99.99&apos;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> price

price
<span class="token comment">---------</span>
$  <span class="token number">2.20</span>
</pre><p><strong>Multi-Relation SELECT Queries:</strong></p>
<p>Similar syntax as before but with multiple relations:</p>
<pre data-role="codeBlock" data-info class="language-"><code>SELECT Attributes
FROM   R1, R2, ...
WHERE  Condition
</code></pre><p>Consider the below example where we find brewers whose beers John likes:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> Manf <span class="token keyword">as</span> brewer
<span class="token keyword">FROM</span>   Likes<span class="token punctuation">,</span> Beers
<span class="token keyword">WHERE</span>  beer <span class="token operator">=</span> name <span class="token operator">AND</span> drinker <span class="token operator">=</span> <span class="token string">&apos;John&apos;</span><span class="token punctuation">;</span>

  brewer
<span class="token comment">---------------</span>
Caledonian
Sierra Nevada
Sierra Nevada
Lord Nelson

<span class="token comment">-- Eliminate duplicates with DISTINCT</span>
</pre><p>Notes:</p>
<ul>
<li>If a selection condition refers to 2 relations of which have attributes with the same name, we use the relation name to disambiguate:</li>
<li>We cannot use AS clause because that&apos;s for output only</li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>SELECT Bars.name
FROM   Bars, Beers
WHERE  Bars.name = Beers.name;
</code></pre><p><strong>Using same relation TWICE in a select:</strong></p>
<p>We define new names for each instance of this relation in the FROM clause:</p>
<pre data-role="codeBlock" data-info class="language-"><code>SELECT r1.a, r2.b
FROM   R r1, R r2
WHERE  r1.a = r2.a
</code></pre><p><strong>Example</strong> below:</p>
<pre data-role="codeBlock" data-info class="language-"><code>SELECT b1.name, b2.name
FROM   Beers b1, Beers b2
WHERE  b1.manf = b2.manf AND b1.name &lt; b2.name;

      name         |       name
---------------------+------------------
Crown Lager         | Fosters Lager
Crown Lager         | Invalid Stout
Crown Lager         | Melbourne Bitter
Crown Lager         | Victoria Bitter
Fosters Lager       | Invalid Stout
Fosters Lager       | Melbourne Bitter
</code></pre><p><strong>Explicit Joins</strong></p>
<p>Explicit joins:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> A <span class="token keyword">natural</span> <span class="token keyword">join</span> B
<span class="token keyword">SELECT</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> A <span class="token keyword">join</span> B <span class="token keyword">using</span> <span class="token punctuation">(</span>A1<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>An<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">FROM</span> A <span class="token keyword">join</span> B <span class="token keyword">on</span> Condition

<span class="token comment">-- Used assuming that the join attributes are named the same in each R</span>
</pre><p><strong>Example</strong> below:<br>
<em>Find all the beers sold at bars where john drinks:</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> Sells<span class="token punctuation">.</span>bar<span class="token punctuation">,</span> beer<span class="token punctuation">,</span> price
<span class="token keyword">FROM</span>   Sells<span class="token punctuation">,</span> Frequents
<span class="token keyword">WHERE</span>  drinker <span class="token operator">=</span> <span class="token string">&apos;John&apos;</span>
     <span class="token operator">AND</span> Sells<span class="token punctuation">.</span>bar <span class="token operator">=</span> Frequents<span class="token punctuation">.</span>bar<span class="token punctuation">;</span>
</pre><p><em>Equivalents</em>:</p>
<ol>
<li></li>
</ol>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> bar<span class="token punctuation">,</span> beer<span class="token punctuation">,</span> price
<span class="token keyword">FROM</span>   Sells <span class="token keyword">natural</span> <span class="token keyword">join</span> Frequents
<span class="token keyword">WHERE</span>  drinker<span class="token operator">=</span><span class="token string">&apos;John&apos;</span><span class="token punctuation">;</span>
     <span class="token comment">-- joins on the only common attribute: bar</span>
</pre><ol start="2">
<li></li>
</ol>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> bar<span class="token punctuation">,</span> beer<span class="token punctuation">,</span> price
<span class="token keyword">FROM</span>   Sells <span class="token keyword">join</span> Frequents <span class="token keyword">using</span> <span class="token punctuation">(</span>bar<span class="token punctuation">)</span>
<span class="token keyword">WHERE</span>  drinker<span class="token operator">=</span><span class="token string">&apos;John&apos;</span><span class="token punctuation">;</span>
     <span class="token comment">-- only one bar attribute in join result</span>
</pre><ol start="3">
<li></li>
</ol>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> Sells<span class="token punctuation">.</span>bar<span class="token punctuation">,</span> beer<span class="token punctuation">,</span> price
<span class="token keyword">FROM</span>   Sells <span class="token keyword">join</span> Frequents
         <span class="token keyword">on</span> Sells<span class="token punctuation">.</span>bar <span class="token operator">=</span> Frequents<span class="token punctuation">.</span>bar
<span class="token keyword">WHERE</span>  drinker<span class="token operator">=</span><span class="token string">&apos;John&apos;</span><span class="token punctuation">;</span>
     <span class="token comment">-- bar attribute occurs twice in join result</span>
</pre><p><strong>Outer Joins:</strong></p>
<p>Join only produces tuples where matching values exist in both sides of the relation i.e. they don&apos;t consider nulls</p>
<p>In our examples, we can show ALL regions even if there aren&apos;t any drinkers there using OUTER JOIN</p>
<ul>
<li>
<p>The <code>R LEFT OUTER JOIN S</code>:</p>
<ul>
<li>All tuples in R have an entry, if a tuple from R has no matches in S, attributes from S are NULL</li>
</ul>
<pre data-role="codeBlock" data-info class="language-"><code>  SELECT B.addr, F.drinker
FROM   Bars as B
      left outer join
   Frequents as F
      on (bar = name)
ORDER BY B.addr;

addr    | drinker
------------+---------
Coogee     | Adam
Coogee     | John
Kingsford  | Justin
Randwick   |
Sydney     | Justin
The Rocks  | John
</code></pre></li>
<li>
<p>The <code>R RIGHT OUTER JOIN S</code>:</p>
<ul>
<li>All tuples in S have an entry, Null-fills any S tuple with no match in R</li>
</ul>
</li>
<li>
<p>The <code>R FULL OUTER JOIN S</code>:</p>
<ul>
<li>Includes all tuples from R and S in the result, those without matches in other relation are NULL filled.</li>
</ul>
</li>
</ul>
<p><strong>Subqueries:</strong></p>
<p>The result of a SELECT-FROM-WHERE query can be used in the WHERE clause of another query.</p>
<p>Simplest case example:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span>   R
<span class="token keyword">WHERE</span>  R<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> x <span class="token keyword">FROM</span> S <span class="token keyword">WHERE</span> Cond<span class="token punctuation">)</span>
           <span class="token comment">-- assume only one result</span>
</pre><p>Another example:</p>
<p><em>Finding bars serving &apos;New&apos; at the same price as VB from Coogee Bay Hotel</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> bar
<span class="token keyword">FROM</span>   Sells
<span class="token keyword">WHERE</span>  beer <span class="token operator">=</span> <span class="token string">&apos;New&apos;</span> <span class="token operator">AND</span>
     price <span class="token operator">=</span>
        <span class="token punctuation">(</span><span class="token keyword">SELECT</span> price
         <span class="token keyword">FROM</span>   Sells
         <span class="token keyword">WHERE</span>  bar <span class="token operator">=</span> <span class="token string">&apos;Coogee Bay Hotel&apos;</span>
                <span class="token operator">AND</span> beer <span class="token operator">=</span> <span class="token string">&apos;Victoria Bitter&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   bar
<span class="token comment">-------------</span>
Royal Hotel
</pre><p>Note:</p>
<ul>
<li>Look how <code>beer</code> and <code>bar</code> was repeated in the subquery, this is fine since an attribute refers to the closest nested relation with that attribute - to set the scope, we require the braces.</li>
</ul>
<p>Alternative:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> s1<span class="token punctuation">.</span>bar
<span class="token keyword">FROM</span>   Sells <span class="token keyword">as</span> s1<span class="token punctuation">,</span> Sells <span class="token keyword">as</span> s2
<span class="token keyword">WHERE</span>  s1<span class="token punctuation">.</span>beer <span class="token operator">=</span> <span class="token string">&apos;New&apos;</span>
     <span class="token operator">AND</span> s1<span class="token punctuation">.</span>price <span class="token operator">=</span> s2<span class="token punctuation">.</span>price
     <span class="token operator">AND</span> s2<span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token string">&apos;Coogee Bay Hotel&apos;</span>
     <span class="token operator">AND</span> s2<span class="token punctuation">.</span>beer <span class="token operator">=</span> <span class="token string">&apos;Victoria Bitter&apos;</span><span class="token punctuation">;</span>
<span class="token comment">-- Expressing a query with joins is more efficient than with subqueries</span>
</pre><p><strong>The <code>IN</code> operator</strong>:</p>
<p>This tests whether a specified tuple is contained in a relation i.e. <code>tuple IN relation</code> is true iff tuple contained in the relationship.</p>
<p><em>Syntax</em>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span>   R
<span class="token keyword">WHERE</span>  R<span class="token punctuation">.</span>a <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> x <span class="token keyword">FROM</span> S <span class="token keyword">WHERE</span> Cond<span class="token punctuation">)</span>
            <span class="token comment">-- assume multiple results</span>
</pre><p>An example:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span>   Beers
<span class="token keyword">WHERE</span>  name <span class="token operator">IN</span>
        <span class="token punctuation">(</span><span class="token keyword">SELECT</span> beer
         <span class="token keyword">FROM</span>   Likes
         <span class="token keyword">WHERE</span>  drinker <span class="token operator">=</span> <span class="token string">&apos;John&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      name         <span class="token operator">|</span>     manf
<span class="token comment">---------------------+---------------</span>
<span class="token number">80</span><span class="token operator">/</span><span class="token operator">-</span>                <span class="token operator">|</span> Caledonian
Bigfoot Barley Wine <span class="token operator">|</span> Sierra Nevada
Pale Ale            <span class="token operator">|</span> Sierra Nevada
Three Sheets        <span class="token operator">|</span> Lord Nelson
</pre><p><strong>The <code>EXISTS</code> Function</strong>:</p>
<p>EXISTS(relation) is true iff the relation is non-empty.</p>
<p><strong>Example</strong>: Find the beers that are the unique beer by their manufacturer.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> manf
<span class="token keyword">FROM</span>   Beers b1
<span class="token keyword">WHERE</span>  <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span>
        <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span>
         <span class="token keyword">FROM</span>   Beers
         <span class="token comment">-- b1 refers to outer Beers</span>
         <span class="token keyword">WHERE</span>  manf <span class="token operator">=</span> b1<span class="token punctuation">.</span>manf
                <span class="token operator">AND</span> name <span class="token operator">!=</span> b1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Quantifiers:</strong><br>
<code>ANY</code> and <code>ALL</code> behave as existential and universal quantifiers respectively.</p>
<p><strong>Example</strong>: Find the beers sold for the highest price.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> beer
<span class="token keyword">FROM</span>   Sells
<span class="token keyword">WHERE</span>  price <span class="token operator">&gt;=</span>
        <span class="token keyword">ALL</span><span class="token punctuation">(</span><span class="token keyword">SELECT</span> price <span class="token keyword">FROM</span> sells<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Union, Intersection, Difference</strong>:</p>
<p>SQL implements the standard set operations on &quot;union-compatible&quot; relations:</p>
<p><code>R1 UNION R2</code> set of tuples in either R1 or R2<br>
<code>R1 INTERSECT R2</code> set of tuples in both R1 and R2<br>
<code>R1 EXCEPT R2</code> set of tuples in R1 but not R2</p>
<p><strong>Example 1</strong>: Find the drinkers and beers such that the drinker likes the beer and frequents a bar that sells it.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Likes<span class="token punctuation">)</span>
<span class="token keyword">INTERSECT</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> drinker<span class="token punctuation">,</span>beer
<span class="token keyword">FROM</span>   Sells <span class="token keyword">natural</span> <span class="token keyword">join</span> Frequents<span class="token punctuation">)</span><span class="token punctuation">;</span>

drinker <span class="token operator">|</span>      beer
<span class="token comment">---------+-----------------</span>
Adam    <span class="token operator">|</span> New
John    <span class="token operator">|</span> Three Sheets
Justin  <span class="token operator">|</span> Victoria Bitter
</pre><p><strong>Example 2</strong>: Find bars that each sell all of the beers Justin likes.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- This acts as a divide operator:</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> a<span class="token punctuation">.</span>bar
<span class="token keyword">FROM</span>   Sells a
<span class="token keyword">WHERE</span>  <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>
         <span class="token punctuation">(</span><span class="token keyword">SELECT</span> beer <span class="token keyword">FROM</span> Likes
          <span class="token keyword">WHERE</span> drinker <span class="token operator">=</span> <span class="token string">&apos;Justin&apos;</span><span class="token punctuation">)</span>
         <span class="token keyword">EXCEPT</span>
         <span class="token punctuation">(</span><span class="token keyword">SELECT</span> beer <span class="token keyword">FROM</span> Sells b
          <span class="token keyword">WHERE</span> bar <span class="token operator">=</span> a<span class="token punctuation">.</span>bar<span class="token punctuation">)</span>
     <span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Aggregation Operations:</strong><br>
Selection clauses can contain aggregation operations, e.g. <code>SUM AVG MIN MAX COUNT</code></p>
<p><em>Example 1:</em> What is the <strong>average</strong> price of New?</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span>
<span class="token keyword">FROM</span>   Sells
<span class="token keyword">WHERE</span>  beer <span class="token operator">=</span> <span class="token string">&apos;New&apos;</span><span class="token punctuation">;</span>

     avg
<span class="token comment">------------------</span>
<span class="token number">2.38749998807907</span>
</pre><p><em>Example 2:</em> How many <em>different</em> bars sell beer?</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> bar<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> Sells<span class="token punctuation">;</span>

count
<span class="token comment">---------</span>
   <span class="token number">6</span>
<span class="token comment">-- Note: Without DISTINCT, the result is 15</span>
</pre><p>Note: The notation <code>COUNT(*)</code> gives the number of tuples in a relation.</p>
<p><strong>Grouping:</strong><br>
<code>SELECT-FROM-WHERE</code> can be followed by GROUP BY</p>
<p>General format:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>   attributes<span class="token operator">/</span>aggregations
<span class="token keyword">FROM</span>     relations
<span class="token keyword">WHERE</span>    condition
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> attribute
</pre><p>Example 1: <em>How many beers does each brewer make?</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>   manf<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>manf<span class="token punctuation">)</span>
<span class="token keyword">FROM</span>     Beers
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> manf<span class="token punctuation">;</span>
</pre><p><strong>Note</strong>: Grouping is typically used in queries involving the phrase &quot;for each&quot;.<br>
Restrictions:</p>
<p>Example 2: <em>For each drinker, find the average price of New at the bars they go to</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>   drinker<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&quot;Avg.Price&quot;</span>
<span class="token keyword">FROM</span>     Frequents<span class="token punctuation">,</span> Sells
<span class="token keyword">WHERE</span>    beer <span class="token operator">=</span> <span class="token string">&apos;New&apos;</span>
       <span class="token operator">AND</span> Frequents<span class="token punctuation">.</span>bar <span class="token operator">=</span> Sells<span class="token punctuation">.</span>bar
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> drinker<span class="token punctuation">;</span>

drinker <span class="token operator">|</span> Avg<span class="token punctuation">.</span>Price
<span class="token comment">---------+-----------</span>
Adam    <span class="token operator">|</span>      <span class="token number">2.25</span>
John    <span class="token operator">|</span>      <span class="token number">2.25</span>
Justin  <span class="token operator">|</span>       <span class="token number">2.5</span>
</pre><p><code>HAVING</code> &amp; <strong>Restrictions</strong>:</p>
<p>Notes:</p>
<ul>
<li>
<p>We cannot use <code>GROUP BY</code> to re-order results (Use <code>ORDER BY</code> instead):</p>
<ul>
<li>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- Find the hotel that sells &apos;New&apos; cheapest.</span>
<span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> manf <span class="token keyword">FROM</span> Beers
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> manf<span class="token punctuation">;</span>

ERROR: Attribute beers<span class="token punctuation">.</span>name must be GROUPed <span class="token operator">or</span> used <span class="token operator">in</span> an aggregate <span class="token keyword">function</span>
</pre></li>
</ul>
</li>
<li>
<p>Using aggregation</p>
<ul>
<li>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token comment">-- How to answer the query: Which bar sells &apos;New&apos; cheapest?</span>
<span class="token keyword">SELECT</span> bar
<span class="token keyword">FROM</span>   Sells
<span class="token keyword">WHERE</span>  beer <span class="token operator">=</span> <span class="token string">&apos;New&apos;</span> <span class="token operator">AND</span>
  price <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span>
              <span class="token keyword">FROM</span>   Sells
              <span class="token keyword">WHERE</span>  beer <span class="token operator">=</span> <span class="token string">&apos;New&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bar
<span class="token comment">--------------</span>
Regent Hotel

</pre></li>
</ul>
</li>
<li>
<p>Eliminating groups</p>
<ul>
<li>We can use <code>WHERE</code> condition to eliminate groups but also the <code>HAVING</code> clause</li>
</ul>
</li>
</ul>
<p>Some examples:</p>
<p><strong>Example 1</strong>: Average beer price by suburb excluding hotels in The Rocks.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>   Bars<span class="token punctuation">.</span>addr<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>Sells<span class="token punctuation">.</span>price<span class="token punctuation">)</span>
<span class="token keyword">FROM</span>     Sells<span class="token punctuation">,</span> Bars
<span class="token keyword">WHERE</span>    Bars<span class="token punctuation">.</span>addr <span class="token operator">!=</span> <span class="token string">&apos;The Rocks&apos;</span>
       <span class="token operator">AND</span> Sells<span class="token punctuation">.</span>bar <span class="token operator">=</span> Bars<span class="token punctuation">.</span>name
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> Bars<span class="token punctuation">.</span>addr<span class="token punctuation">;</span>
</pre><p><code>HAVING</code>:</p>
<pre data-role="codeBlock" data-info="SQL" class="language-sql"><span class="token keyword">SELECT</span>   attributes<span class="token operator">/</span>aggregations
<span class="token keyword">FROM</span>     relations
<span class="token keyword">WHERE</span>    condition <span class="token punctuation">(</span><span class="token keyword">on</span> tuples<span class="token punctuation">)</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> attribute
<span class="token keyword">HAVING</span>   condition <span class="token punctuation">(</span><span class="token keyword">on</span> <span class="token keyword">group</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Example 2</strong>: Find the average price of common beers (i.e. those that are served in more than one hotel).</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>   beer<span class="token punctuation">,</span>
       to_char<span class="token punctuation">(</span><span class="token function">AVG</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&apos;9.99&apos;</span><span class="token punctuation">)</span>
         <span class="token keyword">as</span> <span class="token string">&quot;$$$&quot;</span>
<span class="token keyword">FROM</span>     Sells
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> beer
<span class="token keyword">HAVING</span>   <span class="token function">COUNT</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>

    beer       <span class="token operator">|</span>  $$$
<span class="token comment">-----------------+-------</span>
New             <span class="token operator">|</span>  <span class="token number">2.39</span>
Old             <span class="token operator">|</span>  <span class="token number">2.53</span>
Victoria Bitter <span class="token operator">|</span>  <span class="token number">2.40</span>
</pre><p><strong>Example 3</strong>: Find the average price of beers that are either commonly served (in more than one hotel) or are manufactured by Cooper&apos;s.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> beer<span class="token punctuation">,</span> <span class="token function">AVG</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span>
<span class="token keyword">FROM</span>   Sells
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> beer
<span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span>
     <span class="token operator">OR</span> beer <span class="token operator">in</span>
         <span class="token punctuation">(</span><span class="token keyword">SELECT</span> name
          <span class="token keyword">FROM</span>   beers
          <span class="token keyword">WHERE</span>  manf <span class="token operator">=</span> <span class="token string">&apos;Cooper&apos;&apos;s&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    beer       <span class="token operator">|</span>       avg
<span class="token comment">-----------------+------------------</span>
New             <span class="token operator">|</span> <span class="token number">2.38749998807907</span>
Old             <span class="token operator">|</span> <span class="token number">2.53333330154419</span>
Sparkling Ale   <span class="token operator">|</span> <span class="token number">2.79999995231628</span>
Victoria Bitter <span class="token operator">|</span> <span class="token number">2.39999997615814</span>
</pre><p><strong>Example 4</strong>: Find bars that each sell all of the beers Justin likes.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> S<span class="token punctuation">.</span>bar
<span class="token keyword">FROM</span>   Sells S<span class="token punctuation">,</span> Likes L
<span class="token keyword">WHERE</span>  S<span class="token punctuation">.</span>beer <span class="token operator">=</span> L<span class="token punctuation">.</span>beer
     <span class="token operator">AND</span> L<span class="token punctuation">.</span>drinker <span class="token operator">=</span> <span class="token string">&apos;Justin&apos;</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> bar
<span class="token keyword">HAVING</span> <span class="token function">count</span><span class="token punctuation">(</span>S<span class="token punctuation">.</span>beer<span class="token punctuation">)</span> <span class="token operator">=</span>
         <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span>beer<span class="token punctuation">)</span> <span class="token keyword">FROM</span> Likes
          <span class="token keyword">WHERE</span> drinker <span class="token operator">=</span> <span class="token string">&apos;Justin&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre><p><strong>Partitions</strong>:<br>
Partitioning is the database process where very large tables are divided into multiple smaller parts.</p>
<p>Syntax for PARTITION:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> attr1<span class="token punctuation">,</span> attr2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span>
     aggregate1 <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> attri<span class="token punctuation">)</span><span class="token punctuation">,</span>
     aggregate2 <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> attrj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">FROM</span>   <span class="token keyword">Table</span>
<span class="token keyword">WHERE</span>  condition <span class="token keyword">on</span> attributes
</pre><p><strong>Example 1</strong>: Show each city with daily temperature and temperature range</p>
<p><em>Schema: Weather(city,date,temperature)</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span>  city<span class="token punctuation">,</span>  <span class="token keyword">date</span><span class="token punctuation">,</span>  temperature <span class="token keyword">as</span> <span class="token keyword">temp</span><span class="token punctuation">,</span>
      <span class="token function">min</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> city<span class="token punctuation">)</span> <span class="token keyword">as</span> lowest<span class="token punctuation">,</span>
      <span class="token function">max</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> city<span class="token punctuation">)</span> <span class="token keyword">as</span> highest
<span class="token keyword">FROM</span>    Weather<span class="token punctuation">;</span>

<span class="token comment">-- Output: Result(city, date, temp, lowest, highest)</span>
</pre><p>Similar to GROUP BY:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> city<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span> <span class="token function">max</span><span class="token punctuation">(</span>temperature<span class="token punctuation">)</span>
<span class="token keyword">FROM</span>   Weather  <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> city

<span class="token comment">--Result: one tuple for each city -&gt; Result(city,min,max)</span>
</pre><p><strong>Example 2</strong>: get a list of low-scoring students in each course</p>
<p><em>Schema: Enrolment(course,student,mark)</em></p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> course<span class="token punctuation">,</span> student<span class="token punctuation">,</span> mark<span class="token punctuation">,</span>
     <span class="token function">avg</span><span class="token punctuation">(</span>mark<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> course<span class="token punctuation">)</span>
<span class="token keyword">FROM</span>   Enrolments<span class="token punctuation">;</span>
</pre><p><strong>Complex Queries</strong>:</p>
<p>We should break the query into a collection of smaller queries i.e. Subqueries in FROM clause and WITH clause (also as a VIEW)</p>
<p>Using the above example, we use <code>FROM</code>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> course<span class="token punctuation">,</span> student<span class="token punctuation">,</span> mark
<span class="token keyword">FROM</span>   <span class="token punctuation">(</span><span class="token keyword">SELECT</span> course<span class="token punctuation">,</span> student<span class="token punctuation">,</span> mark<span class="token punctuation">,</span>
             <span class="token function">avg</span><span class="token punctuation">(</span>mark<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> course<span class="token punctuation">)</span>
      <span class="token keyword">FROM</span>   Enrolments<span class="token punctuation">)</span> <span class="token keyword">AS</span> CourseMarkAndAverages
<span class="token keyword">WHERE</span>  mark <span class="token operator">&lt;</span> avg<span class="token punctuation">;</span>
</pre><p>General case:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> attributes
<span class="token keyword">FROM</span>   <span class="token punctuation">(</span>Query1<span class="token punctuation">)</span> <span class="token keyword">AS</span> X<span class="token punctuation">,</span>
     <span class="token punctuation">(</span>Query2<span class="token punctuation">)</span> <span class="token keyword">AS</span> Y<span class="token punctuation">,</span>
     <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span>  X<span class="token punctuation">.</span>a <span class="token operator">=</span> Y<span class="token punctuation">.</span>b <span class="token operator">AND</span> other conditions
</pre><p>Using the above example, we use <code>WITH</code>:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">WITH</span> CourseMarksAndAverages <span class="token keyword">AS</span>
   <span class="token punctuation">(</span><span class="token keyword">SELECT</span> course<span class="token punctuation">,</span> student<span class="token punctuation">,</span> mark<span class="token punctuation">,</span>
           <span class="token function">avg</span><span class="token punctuation">(</span>mark<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> course<span class="token punctuation">)</span>
    <span class="token keyword">FROM</span>   CourseEnrolments<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> course<span class="token punctuation">,</span> student<span class="token punctuation">,</span> mark<span class="token punctuation">,</span> avg
<span class="token keyword">FROM</span>   CourseMarksAndAverages
<span class="token keyword">WHERE</span>  mark <span class="token operator">&lt;</span> avg<span class="token punctuation">;</span>
</pre><p>General case:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">WITH</span>   Name1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">(</span>Query1<span class="token punctuation">)</span><span class="token punctuation">,</span>
     Name2 <span class="token keyword">AS</span> <span class="token punctuation">(</span>Query1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">SELECT</span> attributes
<span class="token keyword">FROM</span>   Name1<span class="token punctuation">,</span> Name2<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span>  conditions <span class="token keyword">with</span> attributes <span class="token keyword">of</span> Name1 <span class="token operator">and</span> Name2
</pre><p><strong>Recursive Queries</strong>:</p>
<p><code>WITH</code> also provides a basis for recursive queries, which are structured as:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">WITH</span> RECURSIVE Recurs<span class="token punctuation">(</span>attributes<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">(</span>
   <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">not</span> involving Recurs
 <span class="token keyword">UNION</span>
   <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> Recurs<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> attributes
<span class="token keyword">FROM</span>   Recurs<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">WHERE</span>  condition involving Recurs attributes
</pre><p><strong>Example 1</strong>: Sum the numbers from 1 to 100:</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">WITH</span> RECURSIVE t<span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">(</span>
   <span class="token keyword">SELECT</span> <span class="token number">1</span>
 <span class="token keyword">UNION</span>
   <span class="token keyword">SELECT</span> n<span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> n <span class="token operator">&lt;</span> <span class="token number">100</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token keyword">FROM</span> t<span class="token punctuation">;</span>
</pre><p><strong>Example 2</strong>: Count number of each sub-part in a given part.</p>
<p><em>Schema: Parts(part, sub_part, quantity)</em></p>
<pre data-role="codeBlock" data-info="SQL" class="language-sql"><span class="token keyword">WITH</span> RECURSIVE IncludedParts<span class="token punctuation">(</span>sub_part<span class="token punctuation">,</span> part<span class="token punctuation">,</span> quantity<span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> sub_part<span class="token punctuation">,</span> part<span class="token punctuation">,</span> quantity
<span class="token keyword">FROM</span> Parts <span class="token keyword">WHERE</span> part <span class="token operator">=</span> GivenPart
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>sub_part<span class="token punctuation">,</span> p<span class="token punctuation">.</span>part<span class="token punctuation">,</span> p<span class="token punctuation">.</span>quantity
<span class="token keyword">FROM</span> IncludedParts i<span class="token punctuation">,</span> Parts p
<span class="token keyword">WHERE</span> p<span class="token punctuation">.</span>part <span class="token operator">=</span> i<span class="token punctuation">.</span>sub_part
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> sub_part<span class="token punctuation">,</span> <span class="token function">SUM</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span> <span class="token keyword">as</span> total_quantity
<span class="token keyword">FROM</span> IncludedParts
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> sub_part
</pre><h4 class="mume-header" id="sql-views"><strong>SQL Views</strong>:</h4>

<p>A view is like a <em>&quot;virtual relation&quot;</em> defined via a query.</p>
<p>View definition and removal:</p>
<pre data-role="codeBlock" data-info="SQL" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> ViewName <span class="token keyword">AS</span> Query

<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> ViewName <span class="token punctuation">[</span> <span class="token punctuation">(</span>AttributeNames<span class="token punctuation">)</span> <span class="token punctuation">]</span>
<span class="token keyword">AS</span> Query

<span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> ViewName
</pre><p>Note:</p>
<ul>
<li>Stored tables in a view are called base tables which should be defined before the view itself</li>
</ul>
<p><strong>Example 1</strong>: An avid Carlton drinker might not be interested in any other kinds of beer.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span>  MyBeers  <span class="token keyword">AS</span>
 <span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> manf
 <span class="token keyword">FROM</span>   Beers
 <span class="token keyword">WHERE</span>  manf <span class="token operator">=</span> <span class="token string">&apos;Carlton&apos;</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> MyBeers<span class="token punctuation">;</span>

     name       <span class="token operator">|</span>  manf
<span class="token comment">------------------+---------</span>
Crown Lager      <span class="token operator">|</span> Carlton
Fosters Lager    <span class="token operator">|</span> Carlton
Invalid Stout    <span class="token operator">|</span> Carlton
Melbourne Bitter <span class="token operator">|</span> Carlton
Victoria Bitter  <span class="token operator">|</span> Carlton
</pre><p><strong>Example 2</strong>: We don&apos;t really need the address of inner-city hotels.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span>  InnerCityHotels  <span class="token keyword">AS</span>
 <span class="token keyword">SELECT</span> name<span class="token punctuation">,</span> license
 <span class="token keyword">FROM</span>   Bars
 <span class="token keyword">WHERE</span>  addr <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">&apos;The Rocks&apos;</span><span class="token punctuation">,</span><span class="token string">&apos;Sydney&apos;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> InnerCityHotels<span class="token punctuation">;</span>

    name       <span class="token operator">|</span> license
<span class="token comment">-----------------+---------</span>
Australia Hotel <span class="token operator">|</span>  <span class="token number">123456</span>
Lord Nelson     <span class="token operator">|</span>  <span class="token number">123888</span>
Marble Bar      <span class="token operator">|</span>  <span class="token number">122123</span>
</pre><p><strong>Example 3</strong>: Number of beers produced by each brewer.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> BeersBrewed <span class="token keyword">AS</span>
 <span class="token keyword">SELECT</span> manf <span class="token keyword">as</span> brewer<span class="token punctuation">,</span>
        <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> nbeers
 <span class="token keyword">FROM</span>   beers <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> manf<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> BeersBrewed<span class="token punctuation">;</span>

  brewer     <span class="token operator">|</span> nbeers
<span class="token comment">---------------+--------</span>
Caledonian    <span class="token operator">|</span>      <span class="token number">1</span>
Carlton       <span class="token operator">|</span>      <span class="token number">5</span>
<span class="token keyword">Cascade</span>       <span class="token operator">|</span>      <span class="token number">1</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</pre><p>Notes:</p>
<ul>
<li>A view&apos;s value may change without being explicitly modified (base table updated)</li>
<li>Views may not be be able to be explicitly modified unless simple</li>
</ul>
<p><strong>Example 4</strong>: of view changing when base table changes.</p>
<pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> InnerCityHotels<span class="token punctuation">;</span>
name <span class="token operator">|</span> license
<span class="token comment">-----------------+---------</span>
Australia Hotel <span class="token operator">|</span> <span class="token number">123456</span>
Lord Nelson <span class="token operator">|</span> <span class="token number">123888</span>
Marble Bar <span class="token operator">|</span> <span class="token number">122123</span>

<span class="token comment">-- then the Lord Nelson goes broke</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Bars <span class="token keyword">WHERE</span> name <span class="token operator">=</span> <span class="token string">&apos;Lord Nelson&apos;</span><span class="token punctuation">;</span>

<span class="token comment">-- no explict update has been made to InnerCityHotels</span>
<span class="token keyword">SELECT</span> \<span class="token operator">*</span> <span class="token keyword">FROM</span> InnerCityHotels<span class="token punctuation">;</span>
name <span class="token operator">|</span> license
<span class="token comment">-----------------+---------</span>
Australia Hotel <span class="token operator">|</span> <span class="token number">123456</span>
Marble Bar <span class="token operator">|</span> <span class="token number">122123</span>
</pre><p><strong>Updating views</strong>:</p>
<p>Conditions:</p>
<ul>
<li>The view involves a single relation R</li>
<li>The <code>WHERE</code> clause does not involve R in a subquery</li>
<li>The <code>WHERE</code> clause only uses attributes from the <code>SELECT</code></li>
</ul>
<p>Our example &apos;InnerCityHotel&apos; view is not updatable<br>
Use the <code>INSERT</code> clause</p>

    </div>
  </body></html>

    <!--WEEK 5 LECTURE NOTES-->
    <br>
  <hr>
<div class="footer">
  <div class="table">
    <ul id="horizontal-list">
      <li><a href="https://www.youtube.com/" class="fa fa-youtube"></a></li>
      <li><a href="https://www.reddit.com/r/cscareerquestions/" class="fa fa-reddit"></a></li>
      <li><a href="https://github.com/abdullah527382" class="fa fa-github"></a></li>
    </ul>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
      <script>window.jQuery || document.write('<script src="../assets/js/vendor/jquery.slim.min.js"><\/script>')</script><script src="../assets/dist/js/bootstrap.bundle.min.js"></script>
</html>